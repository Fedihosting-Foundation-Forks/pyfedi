{% if theme() != 'piefed' and file_exists('app/templates/themes/' + theme() + '/base.html') -%}
    {% extends 'themes/' + theme() + '/base.html' -%}
{% else -%}
    {% extends "base.html" -%}
{% endif -%}
{% from 'bootstrap5/form.html' import render_form %}
{% set active_child = 'admin_activities' %}

{% block app_content %}
{% include 'admin/_tabbed_nav.html' %}
<br>
<div class="row">
    <div class="col">
        <h1>{{ _('Activities') }}</h1>
        {{ _('Result Filter') }}:
        <a href="{{ url_for('admin.admin_activities', direction=request.args.get('direction')) }}">{{ _('All') }}</a> |
        <a href="{{ url_for('admin.admin_activities', result='failure', direction=request.args.get('direction')) }}">{{ _('Failure') }}</a> |
        <a href="{{ url_for('admin.admin_activities', result='success', direction=request.args.get('direction')) }}">{{ _('Success') }}</a> |
        <a href="{{ url_for('admin.admin_activities', result='ignored', direction=request.args.get('direction')) }}">{{ _('Ignored') }}</a> |
        <a href="{{ url_for('admin.admin_activities', result='processing', direction=request.args.get('direction')) }}">{{ _('Processing') }}</a> ---
        {{ _('Direction Filter') }}:
        <a href="{{ url_for('admin.admin_activities', result=request.args.get('result')) }}">{{ _('Both') }}</a> |
        <a href="{{ url_for('admin.admin_activities', result=request.args.get('result'), direction='in') }}">{{ _('In') }}</a> |
        <a href="{{ url_for('admin.admin_activities', result=request.args.get('result'), direction='out') }}">{{ _('Out') }}</a>
        <div>
            <table class="table">
                <tr>
                <th>{{ _('When') }}</th>
                <th>{{ _('Direction') }}</th>
                <th>{{ _('ID') }}</th>
                <th>{{ _('Type') }}</th>
                <th>{{ _('Result') }}</th>
                <th>{{ _('Message') }}</th>
                <th>{{ _('JSON') }}</th>
                </tr>
                {% for activity in activities.items %}
                    <tr>
                        <td>{{ arrow.get(activity.created_at).humanize(locale=locale) }}</td>
                        <td>{{ activity.direction }}</td>
                        <td>{{ activity.activity_id }}</td>
                        <td>{{ activity.activity_type if activity.activity_type else ''  }}</td>
                        {% if activity.result == 'success' %}
                            <td><span style="color: green;">{{ activity.result }}</span></td>
                        {% elif activity.result == 'ignored' %}
                            <td><span style="color: orange;">{{ activity.result }}</span></td>
                        {% else %}
                            <td><span style="color: red;">{{ activity.result }}</span></td>
                        {% endif %}
                        <td>{{ activity.exception_message if activity.exception_message else '' }}</td>
                        <td>
                        {% if activity.activity_json is none %}
                            None
                        {% else %}
                            <a href="{{ url_for('admin.activity_json', activity_id=activity.id) }}">View</a>
                        {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>
        <nav aria-label="{{ _('Pagination') }}" class="mt-4" role="navigation">
                {% if prev_url %}
                    <a href="{{ prev_url }}" class="btn btn-primary" rel="nofollow">
                        <span aria-hidden="true">&larr;</span> {{ _('Previous page') }}
                    </a>
                {% endif %}
                {% if next_url %}
                    <a href="{{ next_url }}" class="btn btn-primary">
                        {{ _('Next page') }} <span aria-hidden="true">&rarr;</span>
                    </a>
                {% endif %}
        </nav>
    </div>
</div>
<hr />
<div class="row">
    <div class="col">
        {% include 'admin/_nav.html' %}
    </div>
</div>
<hr />
{% endblock %}
